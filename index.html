<!DOCTYPE html>
<html>
<head>
   <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 100%;
      }
    </style>
</head>
<body>

<p align = "center">
  Hello World !
  Find Donation Location(s) around you -
</p>

<br>

<p align = "center">
  <button onclick="getLocation()"> Search ! </button>
</p>

<p id="demo"></p>

  <div id="map"></div>

<script>
var x = document.getElementById("demo");

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
    } else { 
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}

function initMap() {
  var myLatLng = {lat: 42.2814, lng: 83.7483};

  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 3,
    center: myLatLng
  });
}

function showPosition(position) {
    x.innerHTML = "Latitude: " + position.coords.latitude + 
    "<br>Longitude: " + position.coords.longitude;  
    var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 16,
    center: {lat: position.coords.latitude, lng: position.coords.longitude}
  });

    var marker2 = new google.maps.Marker({
    position: {lat: position.coords.latitude, lng: position.coords.longitude} ,
    map: map,
    title: 'Hello World!'
  });
    var markers = [];
    marker2.setMap(map);
    httpGetAsync('https://maps.googleapis.com/maps/api/geocode/json?latlng=' + position.coords.latitude + ','+ position.coords.longitude, function(data){
      var zip_code = JSON.parse(data).results['0'].address_components['7'].long_name;
      httpGetAsync('/find/'+zip_code+'/'+position.coords.latitude+'/'+position.coords.longitude, function(places){
        var multiData = JSON.parse(places);
        multiData.forEach(function(singleData, upperIndex)
        {
          singleData.forEach(function(element, index){
            console.log(element);
            if(typeof element.Latitude !== 'undefined' && typeof element.Latitude !== 'undefined')
            {
              var one = ['Hello', element.Latitude, element.Longitude];
              markers.push(one);
            }            
          });
        });
      });
    });    
    console.log(markers);
    addMarkers(markers);
}

function httpGetAsync(theUrl, callback)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            callback(xmlHttp.responseText);
    }
    xmlHttp.open("GET", theUrl, true); // true for asynchronous 
    xmlHttp.send(null);
}

function isEmpty(obj) {
    for(var prop in obj) {
        if(obj.hasOwnProperty(prop))
            return false;
    }

    return true;
}

function addMarkers(markers)
{
    var myLatLng = {lat: -25.363, lng: 131.044};
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 3,
      center: myLatLng
    });
    for( i = 0; i < markers.length; i++ ) {
      var position = new google.maps.LatLng(markers[i][1], markers[i][2]);
      bounds.extend(position);
      marker = new google.maps.Marker({
          position: position,
          map: map,
          title: markers[i][0]
      });
      
      // Allow each marker to have an info window    
      google.maps.event.addListener(marker, 'click', (function(marker, i) {
          return function() {
              infoWindow.setContent(infoWindowContent[i][0]);
              infoWindow.open(map, marker);
          }
      })(marker, i));

      // Automatically center the map fitting all markers on the screen
      map.fitBounds(bounds);
  }

 
}
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAptBFoq7wuvRcDlUUqqs_pCODapjof_9o&signed_in=true&callback=initMap"></script>

<br>

</body>
<footer>
  <p align = "center">
Copyright 2015 . Impact6
</p>

<br>

</footer>
</html>